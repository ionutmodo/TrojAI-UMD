Bootstrap: docker
From: pytorch/pytorch:latest

%setup
    rm -rf /umd/
    mkdir /umd/

%files
    ./metamodels/ /umd/
    ./tools/ /umd/
    ./architectures/ /umd/
    ./trojai/ /umd/
    ./umd_pipeline.py /umd/

%post
    apt-get update
    apt-get install -y ffmpeg libsm6 libxext6 libxrender-dev libgtk2.0-dev libmagickwand-dev vim
    pip install --no-cache-dir numpy==1.18.5 pandas opencv-python matplotlib pillow scipy wand scikit-learn scikit-image dill pyllist nltk tqdm
    chmod -R 777 /umd/

%runscript
    exec python3 -W ignore /umd/umd_pipeline.py "$@"
